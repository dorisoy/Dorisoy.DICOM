<ui:FluentWindow x:Class="Sinol.DicomViewer.Views.MainWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:local="clr-namespace:Sinol.DicomViewer"
                 xmlns:views="clr-namespace:Sinol.DicomViewer.Views"
                 xmlns:helpers="clr-namespace:Sinol.DicomViewer.Helpers"
                 xmlns:converters="clr-namespace:Sinol.DicomViewer.Converters"
                 xmlns:viewModels="clr-namespace:Sinol.DicomViewer.ViewModels"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:tray="http://schemas.lepo.co/wpfui/2022/xaml/tray"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 Title="{Binding ViewModel.ApplicationTitle, Mode=OneWay}"
                 Width="1100"
                 Height="650"
                 d:DataContext="{d:DesignInstance views:MainWindow,IsDesignTimeCreatable=True}"
                 d:DesignHeight="450"
                 d:DesignWidth="800"
                 ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
                 ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                 ExtendsContentIntoTitleBar="True"
                 Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                 WindowBackdropType="Mica"
                 WindowCornerPreference="Round"
                 WindowState="Maximized"
                 WindowStyle="None"
                 ResizeMode="CanResize"
                 WindowStartupLocation="CenterScreen"
                 mc:Ignorable="d">

    <ui:FluentWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <helpers:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />

        <converters:MeasurementPointsConverter x:Key="MeasurementPointsConverter" />
        <converters:EnumEqualityConverter x:Key="EnumEqualityConverter" />
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />

        <!-- 专业按钮样式 -->
        <Style TargetType="ToggleButton"
               x:Key="ToolbarToggleButton">
            <Setter Property="Margin"
                    Value="4,0" />
            <Setter Property="Padding"
                    Value="12,6" />
            <Setter Property="Background"
                    Value="#2d2d30" />
            <Setter Property="Foreground"
                    Value="#f1f1f1" />
            <Setter Property="BorderBrush"
                    Value="#3f3f46" />
            <Setter Property="BorderThickness"
                    Value="1" />
            <Setter Property="FontSize"
                    Value="13" />
            <Style.Triggers>
                <Trigger Property="IsChecked"
                         Value="True">
                    <Setter Property="Background"
                            Value="#007acc" />
                    <Setter Property="Foreground"
                            Value="White" />
                </Trigger>
                <Trigger Property="IsMouseOver"
                         Value="True">
                    <Setter Property="Background"
                            Value="#3e3e42" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="Button"
               x:Key="ToolbarButton">
            <Setter Property="Margin"
                    Value="4,0" />
            <Setter Property="Padding"
                    Value="12,6" />
            <Setter Property="Background"
                    Value="#2d2d30" />
            <Setter Property="Foreground"
                    Value="#f1f1f1" />
            <Setter Property="BorderBrush"
                    Value="#3f3f46" />
            <Setter Property="BorderThickness"
                    Value="1" />
            <Setter Property="FontSize"
                    Value="13" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver"
                         Value="True">
                    <Setter Property="Background"
                            Value="#3e3e42" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 信息文本样式 -->
        <Style TargetType="TextBlock"
               x:Key="InfoLabel">
            <Setter Property="Foreground"
                    Value="#cccccc" />
            <Setter Property="FontSize"
                    Value="11" />
            <Setter Property="Margin"
                    Value="0,2" />
        </Style>

        <Style TargetType="TextBlock"
               x:Key="InfoValue">
            <Setter Property="Foreground"
                    Value="#f1f1f1" />
            <Setter Property="FontSize"
                    Value="12" />
            <Setter Property="FontWeight"
                    Value="SemiBold" />
            <Setter Property="Margin"
                    Value="0,2" />
        </Style>
    </ui:FluentWindow.Resources>


    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <!--导航视图-->
        <ui:NavigationView x:Name="RootNavigation"
                           Grid.Row="1"
                           Grid.ColumnSpan="3"
                           IsPaneOpen="False"
                           IsPaneToggleVisible="False"
                           IsBackButtonVisible="Visible"
                           PaneDisplayMode="LeftMinimal"
                           FooterMenuItemsSource="{Binding ViewModel.NavigationFooter, Mode=OneWay}"
                           MenuItemsSource="{Binding ViewModel.NavigationItems, Mode=OneWay}">
        </ui:NavigationView>

        <!--对话框容器-->
        <ContentPresenter x:Name="RootContentDialog"
                          Grid.Row="0"
                          Grid.RowSpan="2"
                          Grid.ColumnSpan="3" />

        <!--自定义标题栏,集成菜单-->
        <ui:TitleBar Title="{Binding ViewModel.ApplicationTitle, Mode=OneWay}"
                     Grid.Row="0"
                     Grid.Column="0"
                     Grid.ColumnSpan="3">
            <ui:TitleBar.Icon>
                <ui:ImageIcon Source="pack://application:,,,/Assets/applicationIcon-256.png"/>
            </ui:TitleBar.Icon>
            <ui:TitleBar.MenuContent>
                <Menu FontSize="14">
                    <ui:MenuItem Header="文件(F)"
                                 Icon="{ui:SymbolIcon Folder20}">
                        <MenuItem Header="从PACS加载..." Click="OnOpenPacsQuery">
                            <MenuItem.Icon>
                                <ui:SymbolIcon Symbol="CloudArrowDown20" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="上传到PACS..." Click="OnUploadToPacs">
                            <MenuItem.Icon>
                                <ui:SymbolIcon Symbol="CloudArrowUp20" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator />
                        <MenuItem Header="PACS服务器管理..." Click="OnManagePacsServers">
                            <MenuItem.Icon>
                                <ui:SymbolIcon Symbol="ServerMultiple20" />
                            </MenuItem.Icon>
                        </MenuItem>
                    </ui:MenuItem>
                    <ui:MenuItem Header="视图(V)"
                                 Icon="{ui:SymbolIcon ContentView20}">
                        <MenuItem x:Name="ToggleSidebarMenuItem" Header="隐藏侧栏" Click="OnToggleSidebar" />
                        <MenuItem Header="重置窗口画布" />
                    </ui:MenuItem>
                    <ui:MenuItem Header="工具(T)"
                                 Icon="{ui:SymbolIcon WindowDevTools20}">
                        <MenuItem Header="MIR-3D重建" />
                        <Separator />
                    </ui:MenuItem>
                    <!--<ui:MenuItem Header="插件(P)"
                                 Icon="{ui:SymbolIcon PlugConnected20}">
                        <MenuItem Header="加载插件" />
                    </ui:MenuItem>-->
                    <ui:MenuItem Header="选项(O)"
                                 Icon="{ui:SymbolIcon Settings20}">
                        <MenuItem Header="配置" />
                    </ui:MenuItem>
                    <ui:MenuItem Header="帮助(H)"
                                 Icon="{ui:SymbolIcon ChatHelp20}">
                        <MenuItem Header="操作说明" Click="OnShowHelpGuide" />
                        <MenuItem Header="检查更新" Click="OnCheckUpdate" />
                    </ui:MenuItem>
                </Menu>
            </ui:TitleBar.MenuContent>

            <ui:TitleBar.RightMenuContent>
                <Menu FontSize="14">
                    <ui:MenuItem Icon="{ui:SymbolIcon Person20}">
                        <!-- 已登录状态显示个人信息和注销 -->
                        <MenuItem Header="个人信息">
                            <MenuItem.Icon>
                                <ui:SymbolIcon Symbol="PersonInfo20" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="注销">
                            <MenuItem.Icon>
                                <ui:SymbolIcon Symbol="SignOut20" />
                            </MenuItem.Icon>
                        </MenuItem>
                    </ui:MenuItem>
                </Menu>
            </ui:TitleBar.RightMenuContent>
        </ui:TitleBar>

        <!--通知栏-->
        <tray:NotifyIcon  Grid.Row="0"
                          Grid.Column="0"
                          FocusOnLeftClick="True"
                          Icon="pack://application:,,,/Assets/applicationIcon-256.png"
                          MenuOnRightClick="True"
                          TooltipText="Sinol.3DMIR">
            <tray:NotifyIcon.Menu>
                <ContextMenu ItemsSource="{Binding ViewModel.TrayMenuItems, Mode=OneWay}" />
            </tray:NotifyIcon.Menu>
        </tray:NotifyIcon>
    </Grid>

</ui:FluentWindow>
